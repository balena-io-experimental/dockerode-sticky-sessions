global
    log stdout format raw local0 debug

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global

frontend docker_frontend
    bind *:2375
    default_backend docker_backend
    
    # Create a stick table based on the custom header
    stick-table type string len 32 size 100k expire 30m
    
    # Use the custom header for sticky sessions
    http-request track-sc0 hdr(X-Docker-Client-ID)

    # Log the client ID and the selected server
    capture request header X-Docker-Client-ID len 32

backend docker_backend
    balance roundrobin
    stick-table type string len 32 size 100k expire 30m
    stick on hdr(X-Docker-Client-ID)
    
    server docker1 docker-daemon-1:2375 check
    server docker2 docker-daemon-2:2375 check

    # Log backend choice
    option httpchk GET /info
    http-check expect status 200
